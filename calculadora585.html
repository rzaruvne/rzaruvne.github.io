<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex">
    <title>SimulaREDE</title>
    <link rel="stylesheet" href="styles2.css">
</head>
<body>
    <!-- Banner image -->
    <img src="banner-simulerede.jpg" alt="Banner Image" class="banner">

    <!-- Separador -->
    <img src="icone-separador.png" alt="separador" class="separador">

    <!-- Menu -->
    <nav class="menu" id="nav">
        <span class="nav-item">
            <a href="https://www.unimed.coop.br/site/web/assessoriaregulamentarpr-parana/home" target=”_blank”>Assessoria Regulamentar</a>
        </span>
        <span class="nav-item">
            <a href="simularede.html">SimulaRede</a>
        </span>
        <span class="nav-item">
            <a href="limitrofes.html">Municípios limítrofes</a>
        </span>
        <span class="nav-item">
            <a href="regiao.html">Região de Saúde</a>
        </span>
        <span class="nav-item">
            <a href="calculadora585.html">Calculadora RN 585</a>
        </span>
    </nav>

    <!-- Separador -->
    <img src="icone-separador.png" alt="separador" class="separador">

    <!-- Text -->
    <div class="text-content">
        <h1>Calculadora RN 585</h1>
	<br>
	<h3>De acordo com a Resolução Normativa 585, para excluir um prestador hospitalar por interesse da operadora ou do próprio prestador, é necessário que o prestador a ser excluído faça parte do grupo responsável por até 80% das internações na sua região de saúde ou que tenha, individualmente, menos de 5% dessas internações. Esta regra se aplica tanto para a exclusão total do prestador quanto para a exclusão parcial de algum de seus serviços.</h3>
	<br>
	    <button class="collapsible-button">Para fins de exclusão parcial de serviços, as categorias foram definidas pela Resolução Normativa 585. Clique aqui para exibir as categorias.</button>
	<br>
    <div class="collapsible-content">
        <p>Internação Psiquiátrica, Internação Obstétrica, Internação Pediátrica, Internação Clínica, Internação Cirúrgica, Internação em UTI Neonatal, Internação em UTI Pediátrica, Internação em UTI Adulto, Atendimento de Urgência e Emergência Adulto e Atendimento de Urgência e Emergência Pediátrico.</p>
    </div>
	<br>
	<br>
	<h3>A calculadora abaixo permite simular se, conforme as regras da RN 585, o hospital pode ser excluído da rede da operadora.</h3>
	<br>
        <form id="hospitalForm">
            <label for="numHospitals">Quantidade de hospitais na região de saúde:</label>
            <input type="number" id="numHospitals" name="numHospitals" min="1" required>
            <br><br>
            <div id="hospitalInputs">
                <!-- Hospital name and hospitalization inputs will be added here -->
            </div>
            <br>
            <input type="submit" value="Calcular">
            <br><br>
            <div id="errorMessage" style="color: red; display: none;">Por favor, preencha todos os campos "Quantidade de internações".</div>
        </form>

        <div id="hospitalTableContainer" style="display: none;">
            <h2>Hospitais da região de saúde</h2>
            <table id="hospitalTable">
                <thead>
                    <tr>
                        <th>Nome do Hospital</th>
                        <th>Quantidade de internações</th>
                        <th>Contribuição individual</th>
                        <th>Percentual cumulativo</th>
                        <th>Poderá ser excluído?</th>
                        <th>Motivo</th>
                    </tr>
                </thead>
                <tbody id="hospitalTableBody">
                    <!-- Hospital data will be added here -->
                </tbody>
            </table>
            <br><br>
        </div>

        <script>
            document.getElementById('hospitalForm').addEventListener('submit', function(event) {
                event.preventDefault(); // Prevent the default form submission

                const numHospitals = parseInt(document.getElementById('numHospitals').value);
                const hospitals = [];
                let allFieldsFilled = true;

                // Collect hospital data from input fields
                for (let i = 1; i <= numHospitals; i++) {
                    const hospitalName = document.getElementById(`hospitalName${i}`).value;
                    const hospitalizationsInput = document.getElementById(`hospitalizations${i}`);
                    const hospitalizations = parseInt(hospitalizationsInput.value);

                    if (isNaN(hospitalizations) || hospitalizationsInput.value.trim() === '') {
                        allFieldsFilled = false;
                        hospitalizationsInput.style.borderColor = 'red';
                    } else {
                        hospitalizationsInput.style.borderColor = '';
                        hospitals.push({ name: hospitalName, hospitalizations: hospitalizations });
                    }
                }

                if (!allFieldsFilled) {
                    document.getElementById('errorMessage').style.display = 'block';
                    return;
                } else {
                    document.getElementById('errorMessage').style.display = 'none';
                }

                // Sort hospitals by hospitalizations (descending order)
                hospitals.sort((a, b) => b.hospitalizations - a.hospitalizations);

                // Calculate total number of hospitalizations
                const totalHospitalizations = hospitals.reduce((acc, curr) => acc + curr.hospitalizations, 0);

                // Populate table with sorted hospital data and percentages
                const tableBody = document.getElementById('hospitalTableBody');
                tableBody.innerHTML = '';

                let cumulativePercentage = 0;
                let previousCumulativePercentage = 0;
                let maxHospitalizations = hospitals[0].hospitalizations; // Highest number of hospitalizations

                hospitals.forEach((hospital, index) => {
                    const row = document.createElement('tr');
                    const nameCell = document.createElement('td');
                    const hospitalizationsCell = document.createElement('td');
                    const percentageCell = document.createElement('td');
                    const cumulativePercentageCell = document.createElement('td');
                    const naoCell = document.createElement('td');
                    const motiveCell = document.createElement('td');

                    nameCell.textContent = hospital.name;
                    hospitalizationsCell.textContent = hospital.hospitalizations;

                    const percentage = (hospital.hospitalizations / totalHospitalizations * 100);
                    percentageCell.textContent = percentage.toFixed(2) + '%';

                    cumulativePercentage += parseFloat(percentage);
                    cumulativePercentageCell.textContent = cumulativePercentage.toFixed(2) + '%';

                    // Check conditions for "Não"
                    if (cumulativePercentage <= 80 && parseFloat(percentage) >= 5) {
                        naoCell.textContent = 'Não';
                        motiveCell.textContent = 'Dentro da faixa dos 80% e contribuição individual maior que 5%';
                    } else if (cumulativePercentage > 80 && previousCumulativePercentage < 80 && parseFloat(percentage) >= 5) {
                        naoCell.textContent = 'Não';
                        motiveCell.textContent = 'Dentro da faixa dos 80% e contribuição individual maior que 5%';
                    } else if (cumulativePercentage >= 80 && hospitals[index - 1] && hospitals[index - 1].hospitalizations === hospital.hospitalizations && hospitals[index - 1].nao === 'Não') {
                        naoCell.textContent = 'Não';
                        motiveCell.textContent = 'Dentro da faixa dos 80%, considerando que há outro hospital com o mesmo número de internações dentro da faixa';
                    } else {
                        naoCell.textContent = 'Sim';
                    }

                    previousCumulativePercentage = cumulativePercentage;

                    row.appendChild(nameCell);
                    row.appendChild(hospitalizationsCell);
                    row.appendChild(percentageCell);
                    row.appendChild(cumulativePercentageCell);
                    row.appendChild(naoCell);
                    row.appendChild(motiveCell);
                    tableBody.appendChild(row);

                    // Apply the highlight-red class if "Não"
                    if (naoCell.textContent === 'Não') {
                        row.classList.add('highlight-red');
                    }

                    // Store "Não" status in hospitals array for future reference
                    hospitals[index].nao = naoCell.textContent;
                });

                // Show the table container
                document.getElementById('hospitalTableContainer').style.display = 'block';
            });

            // Function to dynamically create input fields for hospital names and hospitalizations
            document.getElementById('numHospitals').addEventListener('change', function() {
                const numHospitals = parseInt(this.value);
                const hospitalInputsContainer = document.getElementById('hospitalInputs');
                hospitalInputsContainer.innerHTML = '';

                for (let i = 1; i <= numHospitals; i++) {
                    const hospitalContainer = document.createElement('div');
                    hospitalContainer.className = 'hospital-input';

                    const hospitalNameInput = document.createElement('input');
                    hospitalNameInput.type = 'text';
                    hospitalNameInput.id = `hospitalName${i}`;
                    hospitalNameInput.name = `hospitalName${i}`;
                    hospitalNameInput.placeholder = `Nome hospital ${i}`;
                    hospitalContainer.appendChild(hospitalNameInput);

                    const hospitalizationsInput = document.createElement('input');
                    hospitalizationsInput.type = 'number';
                    hospitalizationsInput.id = `hospitalizations${i}`;
                    hospitalizationsInput.name = `hospitalizations${i}`;
                    hospitalizationsInput.min = 0;
                    hospitalizationsInput.placeholder = `Quantidade de internações`;
                    hospitalContainer.appendChild(hospitalizationsInput);

                    hospitalInputsContainer.appendChild(hospitalContainer);
                }
            });

	document.querySelector('.collapsible-button').addEventListener('click', function() {
            const content = document.querySelector('.collapsible-content');
            if (content.style.display === 'block') {
                content.style.display = 'none';
                this.textContent = 'Clique aqui para exibir as categorias de serviço';
            } else {
                content.style.display = 'block';
                this.textContent = 'Clique aqui para ocultar as categorias de serviço';
            }
        });
        </script>
    </div>

    <!-- Separador -->
    <img src="icone-separador.png" alt="separador" class="separador">
    <script>
    window.addEventListener('load', function() {
        // Seleciona o elemento que você quer que a página role até ele
        var element = document.querySelector('.text-content');
        
        // Verifica se o elemento existe na página
        if (element) {
            // Rola para o elemento
            element.scrollIntoView({ behavior: 'smooth' });
        }
    });
    </script>
</body>
</html>
